"use strict";
Object.defineProperties(exports, {
  use: {get: function() {
      return use;
    }},
  inject: {get: function() {
      return inject;
    }},
  __esModule: {value: true}
});
var $__injector__,
    $__annotations__,
    $__util__,
    $__providers__;
var Injector = ($__injector__ = require("./injector"), $__injector__ && $__injector__.__esModule && $__injector__ || {default: $__injector__}).Injector;
var $__1 = ($__annotations__ = require("./annotations"), $__annotations__ && $__annotations__.__esModule && $__annotations__ || {default: $__annotations__}),
    Inject = $__1.Inject,
    annotate = $__1.annotate,
    readAnnotations = $__1.readAnnotations;
var isFunction = ($__util__ = require("./util"), $__util__ && $__util__.__esModule && $__util__ || {default: $__util__}).isFunction;
var createProviderFromFnOrClass = ($__providers__ = require("./providers"), $__providers__ && $__providers__.__esModule && $__providers__ || {default: $__providers__}).createProviderFromFnOrClass;
var currentSpec = null;
beforeEach(function() {
  currentSpec = this;
  currentSpec.$$providers = [];
});
afterEach(function() {
  currentSpec.$$providers = null;
  currentSpec.$$injector = null;
  currentSpec = null;
});
function isRunning() {
  return !!currentSpec;
}
function use(mock) {
  if (currentSpec && currentSpec.$$injector) {
    throw new Error('Cannot call use() after inject() has already been called.');
  }
  var providerWrapper = {provider: mock};
  var fn = function() {
    currentSpec.$$providers.push(providerWrapper);
  };
  fn.as = function(token) {
    if (currentSpec && currentSpec.$$injector) {
      throw new Error('Cannot call as() after inject() has already been called.');
    }
    providerWrapper.as = token;
    if (isRunning()) {
      return undefined;
    }
    return fn;
  };
  if (isRunning()) {
    fn();
  }
  return fn;
}
function inject() {
  for (var params = [],
      $__4 = 0; $__4 < arguments.length; $__4++)
    params[$__4] = arguments[$__4];
  var behavior = params.pop();
  annotate(behavior, new (Function.prototype.bind.apply(Inject, $traceurRuntime.spread([null], params)))());
  var run = function() {
    if (!currentSpec.$$injector) {
      var providers = new Map();
      var modules = [];
      var annotations;
      currentSpec.$$providers.forEach(function(providerWrapper) {
        if (!providerWrapper.as) {
          modules.push(providerWrapper.provider);
        } else {
          if (!isFunction(providerWrapper.provider)) {
            providers.set(providerWrapper.as, createProviderFromFnOrClass(function() {
              return providerWrapper.provider;
            }, {
              provide: {
                token: null,
                isPromise: false
              },
              params: []
            }));
          } else {
            annotations = readAnnotations(providerWrapper.provider);
            providers.set(providerWrapper.as, createProviderFromFnOrClass(providerWrapper.provider, annotations));
          }
        }
      });
      currentSpec.$$injector = new Injector(modules, null, providers);
    }
    currentSpec.$$injector.get(behavior);
  };
  return isRunning() ? run() : run;
}
;

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImxpYnMvZGkvdGVzdGluZy5qcyIsIkB0cmFjZXVyL2dlbmVyYXRlZC9UZW1wbGF0ZVBhcnNlci82IiwiQHRyYWNldXIvZ2VuZXJhdGVkL1RlbXBsYXRlUGFyc2VyLzQiLCJAdHJhY2V1ci9nZW5lcmF0ZWQvVGVtcGxhdGVQYXJzZXIvMiIsIkB0cmFjZXVyL2dlbmVyYXRlZC9UZW1wbGF0ZVBhcnNlci8zIiwiQHRyYWNldXIvZ2VuZXJhdGVkL1RlbXBsYXRlUGFyc2VyLzUiLCJAdHJhY2V1ci9nZW5lcmF0ZWQvVGVtcGxhdGVQYXJzZXIvMSIsIkB0cmFjZXVyL2dlbmVyYXRlZC9UZW1wbGF0ZVBhcnNlci8xMiIsIkB0cmFjZXVyL2dlbmVyYXRlZC9UZW1wbGF0ZVBhcnNlci8xNCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBLEtBQUssaUJBQWlCLEFBQUMsQ0FBQyxPQUFNO0tDQTlCLEVBQUMsR0FBRSxZQ0FxQjtBQUFFLGdCQUF3QjtJQUFFLEFEQTlCLENBQUM7UUFBdkIsRUFBQyxHQUFFLFlDQXFCO0FBQUUsbUJBQXdCO0lBQUUsQURBOUIsQ0FBQztBRUF2QixXQUFTLENDQVQsRUFBQyxLQUFJLENEQU8sS0FBRyxBQ0FTLENBQUM7Q0pBeUIsQ0FBQzs7Ozs7RURBM0MsU0FBTyxFTUFmLEVBQUMsZUFBb0IsQ0FBQSxPQUFNLEFBQUMsY0FBa0IsQ0FDdEMsQ0FBQSxnQkFBcUIseUJBQTJCLENBQUEsZ0JBQXFCLEdBQUssRUFBQyxPQUFNLGVBQW1CLENBRDlELEFBQytELENBQUM7U0FEOUcsRUFBQyxrQkFBb0IsQ0FBQSxPQUFNLEFBQUMsaUJBQWtCLENBQ3RDLENBQUEsbUJBQXFCLDRCQUEyQixDQUFBLG1CQUFxQixHQUFLLEVBQUMsT0FBTSxrQkFBbUIsQ0FEOUQsQUFDK0QsQ0FBQztBTkF0RyxTQUFLO0FBQUcsV0FBTztBQUFHLGtCQUFjO0VBQ2hDLFdBQVMsRU1GakIsRUFBQyxXQUFvQixDQUFBLE9BQU0sQUFBQyxVQUFrQixDQUN0QyxD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QWMsU0FBUyxDQUFDLENBQUM7UUFDeEMsS0FBTztBQUNMLGFBQUksQ0FBQyxVQUFTLEFBQUMsQ0FBQyxlQUFjLFNBQVMsQ0FBQyxDQUFHO0FBRXpDLG9CQUFRLElBQUksQUFBQyxDQUFDLGVBQWMsR0FBRyxDQUFHLENBQUEsMkJBQTBCLEFBQUMsQ0FBQyxTQUFRLEFBQUMsQ0FBRTtBQUN2RSxtQkFBTyxDQUFBLGVBQWMsU0FBUyxDQUFDO1lBQ2pDLENBQUc7QUFBQyxvQkFBTSxDQUFHO0FBQUMsb0JBQUksQ0FBRyxLQUFHO0FBQUcsd0JBQVEsQ0FBRyxNQUFJO0FBQUEsY0FBQztBQUFHLG1CQUFLLENBQUcsR0FBQztBQUFBLFlBQUMsQ0FBQyxDQUFDLENBQUM7VUFDN0QsS0FBTztBQUVMLHNCQUFVLEVBQUksQ0FBQSxlQUFjLEFBQUMsQ0FBQyxlQUFjLFNBQVMsQ0FBQyxDQUFDO0FBQ3ZELG9CQUFRLElBQUksQUFBQyxDQUFDLGVBQWMsR0FBRyxDQUFHLENBQUEsMkJBQTBCLEFBQUMsQ0FBQyxlQUFjLFNBQVMsQ0FBRyxZQUFVLENBQUMsQ0FBQyxDQUFDO1VBQ3ZHO0FBQUEsUUFDRjtBQUFBLE1BQ0YsQ0FBQyxDQUFDO0FBRUYsZ0JBQVUsV0FBVyxFQUFJLElBQUksU0FBTyxBQUFDLENBQUMsT0FBTSxDQUFHLEtBQUcsQ0FBRyxVQUFRLENBQUMsQ0FBQztJQUNqRTtBQUFBLEFBRUEsY0FBVSxXQUFXLElBQUksQUFBQyxDQUFDLFFBQU8sQ0FBQyxDQUFDO0VBQ3RDLENBQUM7QUFFRCxPQUFPLENBQUEsU0FBUSxBQUFDLEVBQUMsQ0FBQSxDQUFJLENBQUEsR0FBRSxBQUFDLEVBQUMsQ0FBQSxDQUFJLElBQUUsQ0FBQztBQUNsQzs7QUFLQSIsImZpbGUiOiJsaWJzL2RpL3Rlc3RpbmcuanMiLCJzb3VyY2VSb290IjoiLi4vLi4iLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQge0luamVjdG9yfSBmcm9tICcuL2luamVjdG9yJztcbmltcG9ydCB7SW5qZWN0LCBhbm5vdGF0ZSwgcmVhZEFubm90YXRpb25zfSBmcm9tICcuL2Fubm90YXRpb25zJztcbmltcG9ydCB7aXNGdW5jdGlvbn0gZnJvbSAnLi91dGlsJztcbmltcG9ydCB7Y3JlYXRlUHJvdmlkZXJGcm9tRm5PckNsYXNzfSBmcm9tICcuL3Byb3ZpZGVycyc7XG5cblxudmFyIGN1cnJlbnRTcGVjID0gbnVsbDtcbmJlZm9yZUVhY2goZnVuY3Rpb24oKSB7XG4gIGN1cnJlbnRTcGVjID0gdGhpcztcbiAgY3VycmVudFNwZWMuJCRwcm92aWRlcnMgPSBbXTtcbn0pO1xuXG5hZnRlckVhY2goZnVuY3Rpb24oKSB7XG4gIGN1cnJlbnRTcGVjLiQkcHJvdmlkZXJzID0gbnVsbDtcbiAgY3VycmVudFNwZWMuJCRpbmplY3RvciA9IG51bGw7XG4gIGN1cnJlbnRTcGVjID0gbnVsbDtcbn0pO1xuXG5mdW5jdGlvbiBpc1J1bm5pbmcoKSB7XG4gIHJldHVybiAhIWN1cnJlbnRTcGVjO1xufVxuXG5mdW5jdGlvbiB1c2UobW9jaykge1xuICBpZiAoY3VycmVudFNwZWMgJiYgY3VycmVudFNwZWMuJCRpbmplY3Rvcikge1xuICAgIHRocm93IG5ldyBFcnJvcignQ2Fubm90IGNhbGwgdXNlKCkgYWZ0ZXIgaW5qZWN0KCkgaGFzIGFscmVhZHkgYmVlbiBjYWxsZWQuJyk7XG4gIH1cblxuICB2YXIgcHJvdmlkZXJXcmFwcGVyID0ge1xuICAgIHByb3ZpZGVyOiBtb2NrXG4gIH07XG5cbiAgdmFyIGZuID0gZnVuY3Rpb24oKSB7XG4gICAgY3VycmVudFNwZWMuJCRwcm92aWRlcnMucHVzaChwcm92aWRlcldyYXBwZXIpO1xuICB9O1xuXG4gIGZuLmFzID0gZnVuY3Rpb24odG9rZW4pIHtcbiAgICBpZiAoY3VycmVudFNwZWMgJiYgY3VycmVudFNwZWMuJCRpbmplY3Rvcikge1xuICAgICAgdGhyb3cgbmV3IEVycm9yKCdDYW5ub3QgY2FsbCBhcygpIGFmdGVyIGluamVjdCgpIGhhcyBhbHJlYWR5IGJlZW4gY2FsbGVkLicpO1xuICAgIH1cblxuICAgIHByb3ZpZGVyV3JhcHBlci5hcyA9IHRva2VuO1xuICAgIGlmIChpc1J1bm5pbmcoKSkge1xuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG5cbiAgICByZXR1cm4gZm47XG4gIH07XG5cbiAgaWYgKGlzUnVubmluZygpKSB7XG4gICAgZm4oKTtcbiAgfVxuXG4gIHJldHVybiBmbjtcbn1cblxuZnVuY3Rpb24gaW5qZWN0KC4uLnBhcmFtcykge1xuICB2YXIgYmVoYXZpb3IgPSBwYXJhbXMucG9wKCk7XG5cbiAgYW5ub3RhdGUoYmVoYXZpb3IsIG5ldyBJbmplY3QoLi4ucGFyYW1zKSk7XG5cbiAgdmFyIHJ1biA9IGZ1bmN0aW9uKCkge1xuICAgIGlmICghY3VycmVudFNwZWMuJCRpbmplY3Rvcikge1xuICAgICAgdmFyIHByb3ZpZGVycyA9IG5ldyBNYXAoKTtcbiAgICAgIHZhciBtb2R1bGVzID0gW107XG4gICAgICB2YXIgYW5ub3RhdGlvbnM7XG5cbiAgICAgIGN1cnJlbnRTcGVjLiQkcHJvdmlkZXJzLmZvckVhY2goZnVuY3Rpb24ocHJvdmlkZXJXcmFwcGVyKSB7XG4gICAgICAgIGlmICghcHJvdmlkZXJXcmFwcGVyLmFzKSB7XG4gICAgICAgICAgLy8gbG9hZCBhcyBhIHJlZ3VsYXIgbW9kdWxlXG4gICAgICAgICAgbW9kdWxlcy5wdXNoKHByb3ZpZGVyV3JhcHBlci5wcm92aWRlcik7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgaWYgKCFpc0Z1bmN0aW9uKHByb3ZpZGVyV3JhcHBlci5wcm92aWRlcikpIHtcbiAgICAgICAgICAgIC8vIGlubGluZWQgbW9ja1xuICAgICAgICAgICAgcHJvdmlkZXJzLnNldChwcm92aWRlcldyYXBwZXIuYXMsIGNyZWF0ZVByb3ZpZGVyRnJvbUZuT3JDbGFzcyhmdW5jdGlvbigpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIHByb3ZpZGVyV3JhcHBlci5wcm92aWRlcjtcbiAgICAgICAgICAgIH0sIHtwcm92aWRlOiB7dG9rZW46IG51bGwsIGlzUHJvbWlzZTogZmFsc2V9LCBwYXJhbXM6IFtdfSkpO1xuICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAvLyBhIGZuL2NsYXNzIHByb3ZpZGVyIHdpdGggb3ZlcnJpZGRlbiB0b2tlblxuICAgICAgICAgICAgYW5ub3RhdGlvbnMgPSByZWFkQW5ub3RhdGlvbnMocHJvdmlkZXJXcmFwcGVyLnByb3ZpZGVyKTtcbiAgICAgICAgICAgIHByb3ZpZGVycy5zZXQocHJvdmlkZXJXcmFwcGVyLmFzLCBjcmVhdGVQcm92aWRlckZyb21Gbk9yQ2xhc3MocHJvdmlkZXJXcmFwcGVyLnByb3ZpZGVyLCBhbm5vdGF0aW9ucykpO1xuICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIGN1cnJlbnRTcGVjLiQkaW5qZWN0b3IgPSBuZXcgSW5qZWN0b3IobW9kdWxlcywgbnVsbCwgcHJvdmlkZXJzKTtcbiAgICB9XG5cbiAgICBjdXJyZW50U3BlYy4kJGluamVjdG9yLmdldChiZWhhdmlvcik7XG4gIH07XG5cbiAgcmV0dXJuIGlzUnVubmluZygpID8gcnVuKCkgOiBydW47XG59XG5cbmV4cG9ydCB7XG4gIHVzZSwgaW5qZWN0XG59O1xuIiwiT2JqZWN0LmRlZmluZVByb3BlcnRpZXMoZXhwb3J0cywgJF9fcGxhY2Vob2xkZXJfXzApOyIsIntnZXQ6ICRfX3BsYWNlaG9sZGVyX18wfSIsImdldCAkX19wbGFjZWhvbGRlcl9fMCgpIHsgcmV0dXJuICRfX3BsYWNlaG9sZGVyX18xOyB9IiwiX19lc01vZHVsZTogdHJ1ZSIsInt2YWx1ZTogJF9fcGxhY2Vob2xkZXJfXzB9IiwiKCRfX3BsYWNlaG9sZGVyX18wID0gcmVxdWlyZSgkX19wbGFjZWhvbGRlcl9fMSksIFxuICAgICAgICAkX19wbGFjZWhvbGRlcl9fMiAmJiAkX19wbGFjZWhvbGRlcl9fMy5fX2VzTW9kdWxlICYmICRfX3BsYWNlaG9sZGVyX180IHx8IHtkZWZhdWx0OiAkX19wbGFjZWhvbGRlcl9fNX0pIiwiXG4gICAgICAgICAgICBmb3IgKHZhciAkX19wbGFjZWhvbGRlcl9fMCA9IFtdLCAkX19wbGFjZWhvbGRlcl9fMSA9IDA7XG4gICAgICAgICAgICAgICAgICRfX3BsYWNlaG9sZGVyX18yIDwgYXJndW1lbnRzLmxlbmd0aDsgJF9fcGxhY2Vob2xkZXJfXzMrKylcbiAgICAgICAgICAgICAgJF9fcGxhY2Vob2xkZXJfXzRbJF9fcGxhY2Vob2xkZXJfXzVdID0gYXJndW1lbnRzWyRfX3BsYWNlaG9sZGVyX182XTsiLCIkdHJhY2V1clJ1bnRpbWUuc3ByZWFkKCRfX3BsYWNlaG9sZGVyX18wKSJdfQ==